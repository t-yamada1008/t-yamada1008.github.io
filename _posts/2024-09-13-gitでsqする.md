---
layout: post
title: gitでsquashする
date: 2024-09-13
categories: [TIL]
tags: [git]
---

久々にやって躓いたのでおさらい。
いつになってもgit rebaseが苦手。

### **1. スクワッシュとは？**

スクワッシュ（squash）とは、複数のコミットを一つのコミットにまとめる操作のことです。これにより、履歴が整理され、より見やすくなります。


### **2. スクワッシュの手順**

スクワッシュを行うには、主に`git rebase -i`（インタラクティブリベース）を使用します。

#### **ステップ1：スクワッシュしたいコミットの範囲を確認**

まず、スクワッシュしたいコミットの数を決めます。例えば、直近の3つのコミットをまとめたい場合：

```bash
git log --oneline -3
```

#### **ステップ2：インタラクティブリベースを開始**

```bash
git rebase -i HEAD~3
```

ここで、`HEAD~3`は過去3つのコミットを対象にします。

#### **ステップ3：エディタでの操作**

コマンドを実行すると、エディタが開き、以下のような内容が表示されます：

```
pick abc1234 コミットメッセージ1
pick def5678 コミットメッセージ2
pick ghi9012 コミットメッセージ3
```

上から古い順に並んでいます。

#### **ステップ4：スクワッシュするコミットを指定**

最初のコミットはそのまま`pick`のままにし、まとめたいコミットを`pick`から`squash`または`s`に変更します：

```
pick abc1234 コミットメッセージ1
squash def5678 コミットメッセージ2
squash ghi9012 コミットメッセージ3
```

#### **ステップ5：エディタを保存して閉じる**

変更を保存してエディタを閉じると、再度エディタが開き、スクワッシュ後のコミットメッセージを編集できます。必要に応じてメッセージを修正してください。

#### **ステップ6：スクワッシュの完了**

エディタを保存して閉じると、Gitがスクワッシュを実行します。`git log`で履歴を確認して、コミットがまとめられていることを確認してください。

---

### **3. よくあるつまずきポイントと対処法**

- **コンフリクトが発生する場合**

  リベース中にコンフリクトが起きた場合、Gitはそれを通知します。以下の手順で解決します：

  1. コンフリクトしているファイルを編集し、コンフリクトを解消します。
  2. コンフリクトを解消したファイルをステージングします：

     ```bash
     git add <ファイル名>
     ```

  3. リベースを続行します：

     ```bash
     git rebase --continue
     ```

- **エディタが開かない場合**

  Gitのデフォルトエディタが設定されていない可能性があります。エディタを設定するには：

  ```bash
  git config --global core.editor "vim"  # お好みのエディタに変更可能
  ```

- **間違ったコミットをスクワッシュしてしまった場合**

  リベースを中断するには：

  ```bash
  git rebase --abort
  ```

  再度リベースをやり直してください。

---

### **4. 注意事項**

- **共有ブランチでのスクワッシュは注意**

  既にリモートにプッシュしたコミットをスクワッシュすると、他の開発者に影響を与える可能性があります。共有ブランチでの履歴書き換えは避けましょう。

- **バックアップを取る**

  リベース前に現在のブランチをバックアップすると安全です：

  ```bash
  git branch backup_branch
  ```

---

### **5. まとめ**

Gitでのスクワッシュは履歴を整理する強力なツールですが、操作を誤ると問題を引き起こす可能性があります。不明な点や不安な場合は、操作前にバックアップを取り、慎重に進めてください。

何か他にご質問があれば、お気軽にお尋ねください。